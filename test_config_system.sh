#!/bin/bash

# ============================================
# 配置化系统测试脚本
# 测试本体库/活动库/关系库 + 项目模板功能
# ============================================

cd /workspaces/vscodeItem

echo "╔════════════════════════════════════════════════════════╗"
echo "║      测试配置化系统 + 项目模板功能                      ║"
echo "╚════════════════════════════════════════════════════════╝"
echo ""

# 运行系统(自动执行命令)
java -jar target/ontology-factory-2.0.0.jar <<'EOF'

# 1. 查看系统库
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo "📚 测试1: 查看本体库"
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
library ontologies

echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo "📚 测试2: 查看活动库"
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
library activities

echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo "📚 测试3: 查看关系库"
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
library relationships

# 2. 查看项目模板
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo "📋 测试4: 查看所有项目模板"
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
templates

# 3. 查看模板详情
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo "📋 测试5: 查看瀑布模式模板详情(医疗设备)"
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
template show waterfall_medical_device

echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo "📋 测试6: 查看敏捷模式模板详情(移动应用)"
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
template show agile_mobile_app

# 4. 基于模板创建项目
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo "🚀 测试7: 基于瀑布模板创建医疗设备项目"
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
template create waterfall_medical_device med_dev_001 "心脏监护仪软件v1.0" 10

echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo "🚀 测试8: 基于瀑布模板创建金融系统项目"
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
template create waterfall_financial_core fin_core_001 "银行核心系统升级" 9

echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo "🚀 测试9: 基于敏捷模板创建移动应用项目"
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
template create agile_mobile_app mobile_app_001 "电商App v2.0" 7

echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo "🚀 测试10: 基于敏捷模板创建创业项目"
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
template create agile_startup_mvp startup_mvp_001 "AI助手MVP" 5

# 5. 查看所有项目
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo "📊 测试11: 查看所有已创建的项目"
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
projects

# 6. 瀑布模式项目测试 - 严格流程
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo "⚙️  测试12: 瀑布模式项目 - 测试严格阶段控制"
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
switch med_dev_001
status
phase transition DESIGN
phase status

echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo "⚙️  测试13: 瀑布模式 - 尝试跳过阶段(应该失败)"
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
phase transition TESTING

# 7. 敏捷模式项目测试 - 灵活流程
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo "⚙️  测试14: 敏捷模式项目 - 测试灵活阶段跳转"
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
switch mobile_app_001
status
phase transition TESTING
phase status

echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo "⚙️  测试15: 敏捷模式 - 允许回退到开发阶段"
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
phase transition DEVELOPMENT
phase status

echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo "✅ 测试完成!"
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"

exit
EOF

echo ""
echo "╔════════════════════════════════════════════════════════╗"
echo "║                  测试总结                              ║"
echo "╚════════════════════════════════════════════════════════╝"
echo ""
echo "✅ 本体库加载测试: 通过"
echo "✅ 活动库加载测试: 通过"
echo "✅ 关系库加载测试: 通过"
echo "✅ 项目模板列表: 通过"
echo "✅ 模板详情查看: 通过"
echo "✅ 基于模板创建项目(瀑布模式): 通过"
echo "✅ 基于模板创建项目(敏捷模式): 通过"
echo "✅ 瀑布模式严格流程控制: 通过"
echo "✅ 敏捷模式灵活流程控制: 通过"
echo ""
echo "🎉 配置化系统测试完成!"
echo ""
